{% comment %}
  ============================================================================
  SECTION: Image with Text Overlay (Simplified)
  - Implements the specific overlay and central text styling.
  - **UPDATE**: Updated the default rich text setting to include a line break (<br>).
  - All colors, text, and dimensions are dynamic via schema settings.
  - Video button/logic has been completely removed.
  ============================================================================
{% endcomment %}

{% style %}
  /* --- SECTION SETTINGS VARIABLES --- */
  .image-overlay-section-{{ section.id }} {
    /* Define CSS Variables for dynamic values */
    --color-text: {{ section.settings.text_color | default: '#000000' }};
    --color-overlay: {{ section.settings.overlay_color | default: '#FFFFFF' }};
    --overlay-opacity: {{ section.settings.overlay_opacity | times: 0.01 | default: 0.3 }};

    /* Set section height dynamically */
    {% assign section_height = section.settings.image_size | default: 'medium' %}
    
    {% case section_height %}
      {% when 'x-small' %}
        height: 40vh;
        min-height: 350px;
      {% when 'small' %}
        height: 60vh;
        min-height: 450px;
      {% when 'medium' %}
        height: 75vh;
        min-height: 550px;
      {% when 'large' %}
        height: 90vh;
        min-height: 650px;
      {% when 'fit_screen' %}
        height: 100vh;
        min-height: 600px;
      {% when 'original' %}
        /* Height will be determined by image ratio and padding, defined below */
        height: auto; 
    {% endcase %}
    
    width: 100%;
    position: relative;
    overflow: hidden;
    color: var(--color-text);
    text-align: center;
    
    {% if section.settings.remove_vertical_spacing %}
      padding: 0;
    {% else %}
      /* Add some internal padding if height is auto (Original ratio) */
      {% if section_height == 'original' %}
        padding: 5rem 0;
      {% endif %}
    {% endif %}

    {% if section.settings.reveal_image_on_scroll %}
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s, transform 0.8s;
    {% endif %}
  }

  /* --- IMAGE CONTAINER & BACKGROUND --- */
  .image-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    
    /* When using Original Image Ratio, use padding-top trick for height */
    {% if section_height == 'original' and section.settings.image %}
      /* Calculate ratio: Height / Width * 100% */
      {% assign image_width = section.settings.image.width %}
      {% assign image_height = section.settings.image.height %}
      {% assign ratio = image_height | divided_by: image_width | times: 100 %}
      padding-top: {{ ratio }}%;
      height: 0; 
    {% endif %}
  }

  /* Desktop Image */
  {% assign desktop_image_url = section.settings.image | image_url: width: 2500 %}
  .image-overlay-section-{{ section.id }} .image-background {
    background-image: url('{{ desktop_image_url }}');
  }

  /* Mobile Image Override */
  {% if section.settings.mobile_image != blank %}
    @media (max-width: 767px) {
      {% assign mobile_image_url = section.settings.mobile_image | image_url: width: 1100 %}
      .image-overlay-section-{{ section.id }} .image-background {
        background-image: url('{{ mobile_image_url }}') !important;
      }
      
      {% if section_height == 'original' and section.settings.mobile_image %}
        {% assign mobile_width = section.settings.mobile_image.width %}
        {% assign mobile_height = section.settings.mobile_image.height %}
        {% assign mobile_ratio = mobile_height | divided_by: mobile_width | times: 100 %}
        .image-overlay-section-{{ section.id }} .image-background {
          padding-top: {{ mobile_ratio }}% !important;
        }
      {% endif %}
    }
  {% endif %}

  /* Overlay Layer */
  .image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
    background-color: var(--color-overlay);
    opacity: var(--overlay-opacity);
  }

  /* --- CONTENT POSITIONING & STYLING --- */
  .content-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 5;
    display: flex;
    flex-direction: column;
    padding: 2rem 1rem;
  }

  /* Apply desktop alignment using flex properties */
  {% assign desktop_pos = section.settings.desktop_content_position | replace: '_', '-' %}
  .content-wrapper {
    {% if desktop_pos contains 'top' %}
      justify-content: flex-start;
    {% elsif desktop_pos contains 'bottom' %}
      justify-content: flex-end;
    {% else %}
      justify-content: center;
    {% endif %}

    {% if desktop_pos contains 'left' %}
      align-items: flex-start;
    {% elsif desktop_pos contains 'right' %}
      align-items: flex-end;
    {% else %}
      align-items: center;
    {% endif %}
  }

  /* Apply mobile alignment using flex properties */
  {% assign mobile_pos = section.settings.mobile_content_position | replace: '_', '-' %}
  @media (max-width: 767px) {
    .content-wrapper {
      {% if mobile_pos contains 'top' %}
        justify-content: flex-start;
      {% elsif mobile_pos contains 'bottom' %}
        justify-content: flex-end;
      {% else %}
        justify-content: center;
      {% endif %}

      {% if mobile_pos contains 'left' %}
        align-items: flex-start;
      {% elsif mobile_pos contains 'right' %}
        align-items: flex-end;
      {% else %}
        align-items: center;
      {% endif %}
    }
  }


  /* --- CONTENT BOX STYLING --- */
  {% assign content_width = section.settings.content_width | default: 'medium' %}
  {% liquid
    assign max_width = '900px'
    if content_width == 'x-small'
      assign max_width = '400px'
    elsif content_width == 'small'
      assign max_width = '600px'
    elsif content_width == 'large'
      assign max_width = '1100px'
    elsif content_width == 'x-large'
      assign max_width = '1400px'
    endif
  %}
  
  .content-container {
    max-width: {{ max_width }};
    width: 100%;
    padding: 0 1rem;
    /* Ensure content text alignment is dynamic based on container position */
    text-align: center;
    
    {% if desktop_pos contains 'left' %}
      text-align: left;
    {% elsif desktop_pos contains 'right' %}
      text-align: right;
    {% endif %}
  }

  @media (max-width: 767px) {
     .content-container {
        /* Reset text alignment on mobile if needed, or follow mobile position */
        text-align: center;
        {% if mobile_pos contains 'left' %}
          text-align: left;
        {% elsif mobile_pos contains 'right' %}
          text-align: right;
        {% endif %}
      }
  }

  /* --- TYPOGRAPHY (DECREASED FONT SIZES) --- */
  .content-container h2 {
    /* Adjusted from 2.5rem, 5vw, 4rem to a smaller range */
    font-size: clamp(1.5rem, 4vw, 3rem); 
    font-weight: bold;
    line-height: 1.1;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
  }
  
  .content-container p {
    /* Adjusted from 1.1rem to 1rem */
    font-size: 1rem;
    margin-top: 0;
  }
  
  /* --- JS utility class for reveal effect --- */
  .image-overlay-section-{{ section.id }}.scroll-in {
    opacity: 1;
    transform: translateY(0);
  }
   @media (max-width: 768px) {
    .responsive-box {
      width: 100% !important;
      margin: 0 auto;
    }
  }
{% endstyle %}

<section
  class="image-overlay-section-{{ section.id }}"
  data-section-id="{{ section.id }}"
  {% if section.settings.reveal_image_on_scroll %}
    data-reveal-on-scroll
  {% endif %}
  >
  
  {% if section.settings.image != blank %}
    <div class="image-background"></div>
  {% endif %}
  
  <div class="image-overlay"></div>

  <div class="content-wrapper">
    <div class="content-container">
      
      {% if section.settings.heading != blank %}
        <h2 class="content-heading">
          {{ section.settings.heading | escape }}
        </h2>
      {% endif %}
      
      {% if section.settings.text != blank %}
        <div class="content-text responsive-box" style="width:650px;margin: 0 auto;">
          {{ section.settings.text }}
        </div>
      {% endif %}
      
    </div>
  </div>
</section>

{% comment %} 
  --- JavaScript for Scroll Reveal --- 
{% endcomment %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sectionElement = document.querySelector('.image-overlay-section-{{ section.id }}');
    
    // --- Scroll Reveal Effect ---
    if (sectionElement && sectionElement.hasAttribute('data-reveal-on-scroll')) {
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('scroll-in');
            observer.unobserve(entry.target);
          }
        });
      }, {
        rootMargin: '0px',
        threshold: 0.1
      });

      observer.observe(sectionElement);
    }
  });
</script>


{% schema %}
  {
    "name": "Image & Text Overlay",
    "tag": "section",
    "class": "section-image-overlay",
    "settings": [
      {
        "type": "header",
        "content": "Image & Dimensions"
      },
      {
        "type": "image_picker",
        "id": "image",
        "label": "Desktop image",
        "info": "2500 x 900px recommended"
      },
      {
        "type": "image_picker",
        "id": "mobile_image",
        "label": "Mobile image (Optional)",
        "info": "1100 x 1500px recommended. Defaults to desktop image."
      },
      {
        "type": "select",
        "id": "image_size",
        "label": "Image Height",
        "default": "medium",
        "options": [
          {
            "value": "original",
            "label": "Original image ratio"
          },
          {
            "value": "x-small",
            "label": "X-Small"
          },
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "medium",
            "label": "Medium"
          },
          {
            "value": "large",
            "label": "Large"
          },
          {
            "value": "fit_screen",
            "label": "Fit screen (100% viewport height)"
          }
        ]
      },
      {
        "type": "checkbox",
        "id": "remove_vertical_spacing",
        "label": "Remove vertical spacing",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "reveal_image_on_scroll",
        "label": "Reveal image on scroll",
        "default": false
      },
      
      {
        "type": "header",
        "content": "Content & Positioning"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "OUR VALUES"
      },
      {
        "type": "richtext",
        "id": "text",
        "label": "Text",
        /* UPDATED DEFAULT VALUE to include <br> for the desired line break */
        "default": "<p>We aspire to be a brand of the 21st century: 100% online and without any intermediary.<br>From you to us directly.</p>"
      },
      {
        "type": "select",
        "id": "content_width",
        "label": "Content width",
        "default": "medium",
        "options": [
          {
            "value": "x-small",
            "label": "X-Small"
          },
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "medium",
            "label": "Medium"
          },
          {
            "value": "large",
            "label": "Large"
          },
          {
            "value": "x-large",
            "label": "X-Large"
          }
        ]
      },
      {
        "type": "select",
        "id": "mobile_content_position",
        "label": "Mobile content position",
        "default": "middle_center",
        "options": [
          { "value": "top_left", "label": "Top left" },
          { "value": "top_center", "label": "Top center" },
          { "value": "top_right", "label": "Top right" },
          { "value": "middle_left", "label": "Middle left" },
          { "value": "middle_center", "label": "Middle center" },
          { "value": "middle_right", "label": "Middle right" },
          { "value": "bottom_left", "label": "Bottom left" },
          { "value": "bottom_center", "label": "Bottom center" },
          { "value": "bottom_right", "label": "Bottom right" }
        ]
      },
      {
        "type": "select",
        "id": "desktop_content_position",
        "label": "Desktop content position",
        "default": "middle_center",
        "options": [
          { "value": "top_left", "label": "Top left" },
          { "value": "top_center", "label": "Top center" },
          { "value": "top_right", "label": "Top right" },
          { "value": "middle_left", "label": "Middle left" },
          { "value": "middle_center", "label": "Middle center" },
          { "value": "middle_right", "label": "Middle right" },
          { "value": "bottom_left", "label": "Bottom left" },
          { "value": "bottom_center", "label": "Bottom center" },
          { "value": "bottom_right", "label": "Bottom right" }
        ]
      },

      {
        "type": "header",
        "content": "Color Scheme"
      },
      {
        "type": "color",
        "id": "text_color",
        "label": "Text Color",
        "default": "#FFFFFF"
      },
      {
        "type": "color",
        "id": "overlay_color",
        "label": "Overlay Color",
        "default": "#000000"
      },
      {
        "type": "range",
        "id": "overlay_opacity",
        "min": 0,
        "max": 100,
        "step": 5,
        "unit": "%",
        "label": "Overlay opacity",
        "default": 30
      }
    ],
    "presets": [
      {
        "name": "Image with Text Overlay",
        "category": "Image"
      }
    ]
  }
{% endschema %}