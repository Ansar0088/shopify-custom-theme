{% comment %}
  A Liquid section for a responsive Before/After image comparison slider.
  Updated with default white background and dark header text for initial section view.
{% endcomment %}

{% assign s = section.settings %}
{% assign cursor_direction = s.cursor_direction | default: 'horizontal' %}
{% assign initial_position_percent = s.initial_position | default: 50 | append: '%' %}

{% assign cursor_style = 'ew-resize' %}
{% if cursor_direction == 'vertical' %}
  {% assign cursor_style = 'ns-resize' %}
{% endif %}

<style>


  /* Base container styles - FIX: Applying schema background color directly here */
  .before-after-section {
    background-color: var(--background-color);
    padding: 60px 0;
    margin: 0;
  }

  .before-after-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Header styles */
  .section-header {
    text-align: center;
    /* margin-bottom: 50px; */
    max-width: 100%;
  }

  .subheading {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--header-text-color);
    /* Uses dark text */
    margin-bottom: 5px;
  }

  .heading {

    font-size: 26px;
    font-weight: 300;
    text-transform: uppercase;
    color: var(--header-text-color);
    /* Uses dark text */
    margin: 0;
    line-height: 1.2;
    letter-spacing: 3px;
  }

  .section-content {
    font-size: 16px;
    color: var(--section-content-color);
    /* Uses default gray content text */
    line-height: 1.6;
    margin-top: 15px;
  }

  /* Slider container */
  .slider-main-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 0;
    box-shadow: none;
  }

  .image-slider-wrapper {
    position: relative;
    overflow: hidden;
    cursor: {{ cursor_style }};
    height: 600px;
    border-radius: 0;
    box-shadow: none;
    background-color: #FFFFFF;
    /* The image wrapper remains white */
  }

  .image-slider-after {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  /* Image styles to ensure they fill the space */
  .image-slider-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Slider Handle */
  .image-slider-handle {
    position: absolute;
    background-color: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    pointer-events: none;
  }

  /* Horizontal Handle */
  .image-slider-wrapper[data-direction="horizontal"] .image-slider-handle {
    top: 0;
    bottom: 0;
    width: 1px;
    margin-left: -0.5px;
  }

  /* Slider Arrow */
  .image-slider-arrow {
    background-color: white;
    border: 1px solid #c0c0c0;
    color: #333333;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    font-size: 14px;
    font-weight: normal;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    cursor: grab;
  }

  /* Image label placement for the current reference image (BOTTOM LEFT/RIGHT) */
  .image-label-bottom {
    position: absolute;
    padding: 8px 20px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 14px;
    z-index: 5;
    bottom: 20px;
    left: 20px;
    background: none;
  }

  /* Link color is explicitly set to the content's color */
  .view-product-btn {
    display: inline-block;
    padding: 0;
    margin: 0;
    text-decoration: none;
    text-transform: capitalize;
    font-weight: 300;
    letter-spacing: 0.5px;
    font-size: 12px;
    transition: color 0.3s ease;
    z-index: 5;
    position: relative;
    border: none !important;
    background: none !important;
  }

  .before .image-label-bottom {
    color: {{ s.before_text_color | default: '#FFFFFF' }};
    /* Default white text on dark placeholder */
  }

  .before .view-product-btn {
    color: {{ s.before_text_color | default: '#FFFFFF' }}
     !important;
  }

  .image-slider-after .image-label-bottom {
    left: auto;
    right: 20px;
    color: {{ s.after_text_color | default: '#333333' }};
    /* Default dark text on light placeholder */
  }

  .image-slider-after .view-product-btn {
    color: {{ s.after_text_color | default: '#333333' }}
     !important;
  }

  /* Responsive styles */
  @media (max-width: 990px) {
    .image-slider-wrapper {
      height: 500px;
    }
    .heading {
      font-size: 24px;
    }
  }

  @media (max-width: 768px) {
    .before-after-section {
      padding: 40px 0;
    }

    .image-slider-wrapper {
      height: 400px;
    }
  }

  @media (max-width: 480px) {
    .image-slider-wrapper {
      height: 300px;
    }

    .heading {
      font-size: 20px;
    }
  }
</style>

<section class="before-after-section">
  <div class="before-after-container">
    <div class="section-header">
      <h2 class="heading">{{ s.heading | escape | default: 'BEFORE/AFTER' }}</h2>
      <div class="section-content">
        {{ s.content | escape | default: 'Showcase your product benefit by using before/after image comparison.' }}
      </div>
    </div>

    <div class="slider-main-container">
      <div
        id="image-slider-{{ section.id }}"
        class="image-slider-wrapper comparison-{{ cursor_direction }}"
        data-direction="{{ cursor_direction }}"
        data-initial-position="{{ s.initial_position | default: 50 }}">

        <div class="before relative w-full h-full">
          {% if s.before_image %}
            <img
              src="{{ s.before_image | image_url: width: 1200 }}"
              alt="{{ s.before_image.alt | escape }}"
              class="w-full h-full object-cover"
              loading="lazy"
              height=""
              width="">
          {% else %}
            {{ 'lifestyle-1' | placeholder_svg_tag: 'w-full h-full object-cover bg-black text-white p-20' }}
          {% endif %}

          <div class="image-label-bottom">
            {{ s.before_text | escape | default: 'BEFORE' }}
            {% if s.before_button_text != blank %}
              <br><a href="{{ s.before_button_link }}" class="view-product-btn">
                {{ s.before_button_text | escape | default: 'View product' }}
              </a>
            {% endif %}
          </div>
        </div>

        <div class="image-slider-after" style="clip-path: {% if cursor_direction == 'horizontal' %}inset(0 0 0 {{ initial_position_percent }}){% else %}inset({{ initial_position_percent }} 0 0 0){% endif %}">
          {% if s.after_image %}
            <img
              src="{{ s.after_image | image_url: width: 1200 }}"
              alt="{{ s.after_image.alt | escape }}"
              class="w-full h-full object-cover absolute left-0 top-0"
              loading="lazy"
              height=""
              width="">
          {% else %}
            {{ 'lifestyle-2' | placeholder_svg_tag: 'w-full h-full object-cover bg-white text-black p-20' }}
          {% endif %}

          <div class="image-label-bottom" style="left: auto; right: 20px;">
            {{ s.after_text | escape | default: 'AFTER' }}
            {% if s.after_button_text != blank %}
              <br><a href="{{ s.after_button_link }}" class="view-product-btn">
                {{ s.after_button_text | escape | default: 'View product' }}
              </a>
            {% endif %}
          </div>
        </div>

        <div class="image-slider-handle" style="{% if cursor_direction == 'horizontal' %}left: {{ initial_position_percent }}{% else %}top: {{ initial_position_percent }}{% endif %}">
          <div class="image-slider-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512">
              <path d="M247.1 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L179.2 256 41.9 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z" /></svg>

          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const slider = document.getElementById('image-slider-' + sectionId);

    if (!slider) return;

    const afterImage = slider.querySelector('.image-slider-after');
    const handle = slider.querySelector('.image-slider-handle');
    const direction = slider.getAttribute('data-direction');
    const isHorizontal = direction === 'horizontal';
    const initialPosition = parseFloat(slider.getAttribute('data-initial-position')) / 100;

    let isDragging = false;
    

    function updatePosition(ratio) {
      if (ratio < 0) ratio = 0;
      if (ratio > 1) ratio = 1;

      const percentage = (ratio * 100).toFixed(2) + '%';
      
      if (isHorizontal) {
        afterImage.style.clipPath = `inset(0 0 0 ${percentage})`;
        handle.style.left = percentage;
      } else {
        afterImage.style.clipPath = `inset(${percentage} 0 0 0)`;
        handle.style.top = percentage;
      }
    }

    function calculateRatio(e) {
      const rect = slider.getBoundingClientRect();
      let pos, dimension;

      const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : null);
      const clientY = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : null);

      if (isHorizontal) {
        pos = clientX - rect.left;
        dimension = rect.width;
      } else {
        pos = clientY - rect.top;
        dimension = rect.height;
      }

      return pos / dimension;
    }

    function initialize() {
      updatePosition(initialPosition);
    }

    function dragMove(e) {
      if (!isDragging) return;
      e.preventDefault();
      
      const ratio = calculateRatio(e);
      updatePosition(ratio);
    }

    function dragStart(e) {
      e.preventDefault();
      isDragging = true;
      slider.style.cursor = 'grabbing';
      const ratio = calculateRatio(e);
      updatePosition(ratio);
    }

    function dragEnd() {
      isDragging = false;
      slider.style.cursor = '{{ cursor_style }}';
    }

    // Event Listeners
    window.addEventListener('load', initialize);
    window.addEventListener('resize', initialize);

    slider.addEventListener('mousedown', dragStart);
    window.addEventListener('mousemove', dragMove);
    window.addEventListener('mouseup', dragEnd);

    slider.addEventListener('touchstart', dragStart, { passive: false });
    window.addEventListener('touchmove', dragMove, { passive: false });
    window.addEventListener('touchend', dragEnd);

  })();
</script>

{% schema %}
  {
    "name": "Before/After Image Slider",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "header",
        "content": "Text Content"
      },
      {
        "type": "text",
        "id": "subheading",
        "label": "Subheading (Optional)",
        "default": "LE DALIA"
      },
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Choose your colour"
      },
      {
        "type": "textarea",
        "id": "content",
        "label": "Content",
        "default": "Showcase your product benefit by using before/after image comparison"
      }, {
        "type": "header",
        "content": "Slider Settings"
      }, {
        "type": "checkbox",
        "id": "border_enabled",
        "label": "Show section border",
        "default": false
      }, {
        "type": "select",
        "id": "cursor_direction",
        "label": "Slider Direction",
        "options": [
          {
            "value": "horizontal",
            "label": "Horizontal"
          }, {
            "value": "vertical",
            "label": "Vertical"
          }
        ],
        "default": "horizontal"
      }, {
        "type": "range",
        "id": "initial_position",
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "%",
        "label": "Initial slider position",
        "default": 50
      }, {
        "type": "color",
        "id": "background_color",
        "label": "Background color",
        "default": "#FFFFFF"
      }, {
        "type": "color",
        "id": "arrows_color",
        "label": "Slider handle color",
        "default": "#333333"
      }, {
        "type": "header",
        "content": "Before Image (Left)"
      }, {
        "type": "image_picker",
        "id": "before_image",
        "label": "Before image"
      }, {
        "type": "text",
        "id": "before_text",
        "label": "Product text/label",
        "default": "BEFORE"
      }, {
        "type": "color",
        "id": "before_text_color",
        "label": "Text/Link color",
        "default": "#FFFFFF"
      }, {
        "type": "text",
        "id": "before_button_text",
        "label": "Button text (Optional)",
        "default": "View product"
      }, {
        "type": "url",
        "id": "before_button_link",
        "label": "Button link"
      }, {
        "type": "select",
        "id": "before_button_style",
        "label": "Button style (Link is forced)",
        "options": [
          {
            "value": "solid",
            "label": "Solid"
          }, {
            "value": "outline",
            "label": "Outline"
          }, {
            "value": "link",
            "label": "Link"
          }
        ],
        "default": "link"
      }, {
        "type": "header",
        "content": "After Image (Right)"
      }, {
        "type": "image_picker",
        "id": "after_image",
        "label": "After image"
      }, {
        "type": "text",
        "id": "after_text",
        "label": "Product text/label",
        "default": "AFTER"
      }, {
        "type": "color",
        "id": "after_text_color",
        "label": "Text/Link color",
        "default": "#333333"
      }, {
        "type": "text",
        "id": "after_button_text",
        "label": "Button text (Optional)",
        "default": "View product"
      }, {
        "type": "url",
        "id": "after_button_link",
        "label": "Button link"
      }, {
        "type": "select",
        "id": "after_button_style",
        "label": "Button style (Link is forced)",
        "options": [
          {
            "value": "solid",
            "label": "Solid"
          }, {
            "value": "outline",
            "label": "Outline"
          }, {
            "value": "link",
            "label": "Link"
          }
        ],
        "default": "link"
      }
    ],
    "presets": [
      {
        "name": "Image Comparison (Before/After)",
        "category": "Image"
      }
    ]
  }
{% endschema %}