<style>
  /* --- SECTION STYLING --- */
  .featured-product-section-{{ section.id }} {
    background-color: var(--color-background);
    color: var(--color-primary-text);
    padding: 60px 20px;
    border-top: 1px solid var(--color-border);
    font-size: {{ settings.font_size_base }}px;
  }

  .featured-product-container {
    margin: 0 auto;
    padding: 0 20px;
    max-width: 1200px;
  }

  /* Adjust max width based on settings */
  {% if section.settings.section_width == 'large' %}
    .featured-product-container {
      max-width: 1400px;
    }
  {% elsif section.settings.section_width == 'x-large' %}
  .featured-product-container {
    max-width: 1600px;
  }
{% elsif section.settings.section_width == 'full' %}
.featured-product-container {
  max-width: 100%;
}
{% endif %}

/* Apply theme font families */
.featured-product-section-{{ section.id }},
.featured-product__subheading,
.featured-product__heading,
.product-details__title,
.product-details__price,
.product-details__description,
.product-details__buy-button,
.quantity-button,
.quantity-input {
  {% if settings.font_body %}
    font-family: {{ settings.font_body.family }}, 
    {{ settings.font_body.fallback_families }};
  {% endif %}
}

/* Apply heading font to headings */
.featured-product__heading,
.product-details__title {
  {% if settings.font_heading %}
    font-family: {{ settings.font_heading.family }}, 
    {{ settings.font_heading.fallback_families }};
  {% endif %}
}

/* --- HEADER STYLES --- */
.featured-product__subheading {
  font-size: {{ settings.font_size_small | default: settings.font_size_base | times: 0.85 | round }}px;
  letter-spacing: 2px;
  text-transform: uppercase;
  font-weight: {{ settings.font_weight_light | default: 300 }};
  margin-bottom: 5px;
  text-align: center;
  color: var(--color-secondary-text);
}

.featured-product__heading {
  font-size: {{ settings.font_size_heading_large | default: 32 }}px;
  font-weight: {{ settings.font_weight_normal | default: 400 }};
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 50px;
  text-align: center;
  color: var(--color-header-text);
}

/* --- PRODUCT LAYOUT (Desktop) --- */
.featured-product__content {
  display: flex;
  gap: 40px;
  align-items: flex-start;
}

.featured-product__media-wrapper {
  flex: 1 1 calc(100% - {{ section.settings.product_info_width | default: 50 }}%);
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  padding-bottom: 50px;
  min-height: 300px;
}

.featured-product__info-wrapper {
  flex: 0 0{{ section.settings.product_info_width | default: 50 }}%;
  padding-top: 20px;
}

/* --- PRODUCT INFO STYLES --- */
.product-details__title {
  font-size: {{ settings.font_size_heading_medium | default: 24 }}px;
  font-weight: {{ settings.font_weight_normal | default: 400 }};
  text-transform: uppercase;
  margin-bottom: 10px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--color-border);
  color: var(--color-header-text);
}

.product-details__price {
  font-size: {{ settings.font_size_base | times: 1.125 | round }}px;
  font-weight: {{ settings.font_weight_bold | default: 600 }};
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 1px solid var(--color-border);
  color: var(--color-primary-text);
}

.product-details__description {
  font-size: {{ settings.font_size_small | default: settings.font_size_base | times: 0.875 | round }}px;
  margin-bottom: 25px;
  line-height: {{ settings.body_line_height | default: 1.6 }};
  color: var(--color-primary-text);
}

/* --- QUANTITY SELECTOR --- */
.quantity-selector {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 25px;
  border: 1px solid var(--color-border);
  width: fit-content;
}

.quantity-button {
  background: none;
  border: none;
  font-size: {{ settings.font_size_base | times: 1.125 | round }}px;
  font-weight: {{ settings.font_weight_medium | default: 500 }};
  cursor: pointer;
  padding: 10px 15px;
  color: var(--color-primary-text);
  transition: background-color 0.2s;
}

.quantity-button:hover {
  background-color: var(--color-border);
}

.quantity-input {
  width: 40px;
  text-align: center;
  border: none;
  -moz-appearance: textfield;
  font-size: {{ settings.font_size_base }}px;
  color: var(--color-primary-text);
  padding: 10px 0;
  background: transparent;
}

.quantity-input::-webkit-outer-spin-button,
.quantity-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* --- ADD TO CART BUTTON --- */
.product-details__buy-button {
  background-color: var(--color-button-filled);
  color: var(--color-button-filled-label);
  border: 1px solid var(--color-button-filled);
  padding: 15px 30px;
  text-transform: uppercase;
  font-size: {{ settings.font_size_small | default: settings.font_size_base | times: 0.875 | round }}px;
  font-weight: {{ settings.font_weight_bold | default: 600 }};
  letter-spacing: 1px;
  cursor: pointer;
  width: 100%;
  transition: opacity 0.3s
  , background-color 0.3s;
}

.product-details__buy-button:hover {
  opacity: 0.9;
}

.product-details__buy-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* --- MEDIA CAROUSEL STYLES --- */
.media-slides {
  position: relative;
  max-width: 500px;
  margin: 0 auto;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.media-slide {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  line-height: 0;
  opacity: 0;
  transition: opacity 0.5s ease;
  text-align: center;
  display: flex;
  justify-content: center;
  align-items: center;
}

.media-slide.active {
  display: flex;
  opacity: 1;
  position: relative;
}

.media-slide img {
  max-width: 90%;
  max-height: 400px;
  width: auto;
  height: auto;
  object-fit: contain;
  display: block;
}

.media-video-wrapper video {
  max-width: 90%;
  max-height: 400px;
  width: auto;
  height: auto;
  object-fit: contain;
}

.media-dots {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  padding: 10px 0;
  z-index: 10;
}

.media-dot {
  width: 8px;
  height: 8px;
  background-color: var(--color-border);
  border-radius: 50%;
  cursor: pointer;
  transition: background-color 0.3s;
}

.media-dot.active {
  background-color: var(--color-primary-text);
}

/* --- MOBILE RESPONSIVENESS --- */
@media (max-width: 990px) {
  .featured-product-container {
    padding: 0 10px;
  }

  .featured-product__content {
    flex-direction: column;
    gap: 30px;
  }

  .featured-product__media-wrapper {
    width: 100%;
    padding-bottom: 30px;
    min-height: 250px;
  }

  .media-slide img,
  .media-video-wrapper video {
    max-width: 100%;
    max-height: 300px;
  }

  .featured-product__info-wrapper {
    width: 100%;
    padding-top: 0;
  }

  {% if section.settings.center_mobile_info %}
    .featured-product__info-wrapper {
      text-align: center;
    }

    .product-details__title,
    .product-details__description,
    .product-details__price {
      text-align: center;
    }

    .quantity-selector {
      margin-left: auto;
      margin-right: auto;
    }

    .product-details__buy-button {
      max-width: 300px;
      margin: 0 auto;
    }
  {% endif %}
}

@media (max-width: 500px) {
  .featured-product-section-{{ section.id }} {
    padding: 40px 15px;
  }

  .featured-product__heading {
    font-size: {{ settings.font_size_heading_medium | default: 24 }}px;
    margin-bottom: 30px;
  }

  .product-details__title {
    font-size: {{ settings.font_size_heading_small | default: 20 }}px;
  }

  .product-details__price {
    font-size: {{ settings.font_size_base }}px;
  }

  .featured-product__subheading {
    font-size: {{ settings.font_size_small | default: settings.font_size_base | times: 0.75 | round }}px;
  }
}
</style>

<section class="featured-product-section-{{ section.id }} color-{{ section.settings.color_scheme.id | default: settings.color_schemes.first.id }}">
  <div class="featured-product-container">
    {% comment %} Section Header {% endcomment %}
    <p class="featured-product__subheading">{{ section.settings.subheading | default: 'OUR SELECTION' }}</p>
    <h2 class="featured-product__heading">{{ section.settings.heading | default: 'PRODUCT OF THE WEEK' }}</h2>

    {% assign current_product = section.settings.product %}

      {% if current_product == blank %}
      {% comment %} Placeholder content {% endcomment %}
      <div class="featured-product__content">
        <div class="featured-product__media-wrapper">
          <div class="media-slides" id="media-slides-{{ section.id }}">
            <div class="media-slide active">
              <div style="max-width: 400px; margin: 0 auto; padding: 20px;">
                <svg
                  viewBox="0 0 500 200"
                  xmlns="http://www.w3.org/2000/svg"
                  style="fill:none; stroke:var(--color-primary-text); stroke-width:3; stroke-linecap:round; stroke-linejoin:round; width:100%; height:auto;">
                  <rect
                    x="100"
                    y="50"
                    width="150"
                    height="80"
                    rx="10"
                    ry="10" />
                  <rect
                    x="250"
                    y="50"
                    width="150"
                    height="80"
                    rx="10"
                    ry="10" />
                  <path d="M100 90 L0 80 M400 90 L500 80" />
                  <circle
                    cx="250"
                    cy="90"
                    r="10" />
                </svg>
              </div>
            </div>
            <div class="media-slide">
              <div style="width: 100%; height: 200px; max-width: 400px; background: var(--color-border); display: flex; align-items: center; justify-content: center; color: var(--color-secondary-text);">NO IMAGE 2</div>
            </div>
          </div>
          <div class="media-dots" id="media-dots-{{ section.id }}">
            <div class="media-dot active" data-index="0"></div>
            <div class="media-dot" data-index="1"></div>
          </div>
        </div>

        <div class="featured-product__info-wrapper">
          <p class="product-details__title">PRODUCT</p>
          <div class="product-details__description">Write text about your product.</div>
          <p class="product-details__price">Â£99.99</p>

          <div class="quantity-selector">
            <button
              type="button"
              class="quantity-button"
              name="minus"
              aria-label="Decrease quantity">-</button>
            <input
              type="number"
              name="quantity"
              id="quantity-{{ section.id }}"
              value="1"
              min="1"
              class="quantity-input"
              form="product-form-{{ section.id }}">
            <button
              type="button"
              class="quantity-button"
              name="plus"
              aria-label="Increase quantity">+</button>
          </div>

          <button class="product-details__buy-button">Add to Cart</button>
        </div>
      </div>

    {% else %}
      {% comment %} Live Product Content {% endcomment %}
      {% assign product_form_id = 'product-form-' | append: section.id %}

      <div class="featured-product__content">
        <div class="featured-product__media-wrapper">
          <div class="media-slides" id="media-slides-{{ section.id }}">
            {% for media in current_product.media limit: 4 %}
              <div class="media-slide {% if forloop.first %}active{% endif %}" data-media-id="{{ media.id }}">
                {% case media.media_type %}
                  {% when 'image' %}
                    {{ media | image_url: width: 800 | image_tag: loading: 'lazy', sizes: '(max-width: 990px) 100vw, 50vw', alt: media.alt }}
                  {% when 'video'
                    , 'external_video' %}
                    <div class="media-video-wrapper">
                      {{ media | video_tag: controls: true, loop: section.settings.enable_video_looping, class: 'product-video', image_size: '800x' }}
                    </div>
                  {% else %}
                    {{ media | image_url: width: 800 | image_tag: loading: 'lazy', sizes: '(max-width: 990px) 100vw, 50vw', alt: media.alt }}
                {% endcase %}
              </div>
            {% endfor %}
          </div>

          {% if current_product.media.size > 1 %}
            <div class="media-dots" id="media-dots-{{ section.id }}">
              {% for media in current_product.media limit: 4 %}
                <div class="media-dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}"></div>
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <div class="featured-product__info-wrapper">
          <p class="product-details__title">{{ current_product.title }}</p>
          <p class="product-details__price">{{ current_product.price | money }}</p>

          {% form 'product'
            , current_product
            , id: product_form_id
            , class: 'product-form' %}
            <input
              type="hidden"
              name="id"
              value="{{ current_product.variants.first.id }}">

            <div class="quantity-selector">
              <button
                type="button"
                class="quantity-button"
                name="minus"
                aria-label="Decrease quantity">-</button>
              <input
                type="number"
                name="quantity"
                id="quantity-{{ section.id }}"
                value="1"
                min="1"
                class="quantity-input">
              <button
                type="button"
                class="quantity-button"
                name="plus"
                aria-label="Increase quantity">+</button>
            </div>

            <button
              type="submit"
              name="add"
              class="product-details__buy-button"
              {% if current_product.variants.first.available == false %}
              disabled
              {% endif %}>
              {% if current_product.variants.first.available %}
                ADD TO CART
              {% else %}
                SOLD OUT
              {% endif %}
            </button>
          {% endform %}
        </div>
      </div>
    {% endif %}
  </div>
</section>

<script>
  // Dynamic Product Media Slider (Carousel) Logic
  const slidesContainer_{{ section.id }} = document.getElementById('media-slides-{{ section.id }}');
  const dotsContainer_{{ section.id }} = document.getElementById('media-dots-{{ section.id }}');
  
  if (slidesContainer_{{ section.id }} && dotsContainer_{{ section.id }}) {
    const slides_{{ section.id }} = slidesContainer_{{ section.id }}.querySelectorAll('.media-slide');
    const dots_{{ section.id }} = dotsContainer_{{ section.id }}.querySelectorAll('.media-dot');
    let currentIndex_{{ section.id }} = 0;

    function showSlide_{{ section.id }}(index) {
      slides_{{ section.id }}.forEach(slide => slide.classList.remove('active'));
      dots_{{ section.id }}.forEach(dot => dot.classList.remove('active'));

      if (slides_{{ section.id }}[index]) {
        slides_{{ section.id }}[index].classList.add('active');
      }
      if (dots_{{ section.id }}[index]) {
        dots_{{ section.id }}[index].classList.add('active');
      }
      currentIndex_{{ section.id }} = index;
    }

    dots_{{ section.id }}.forEach(dot => {
      dot.addEventListener('click', function() {
        const index = parseInt(this.getAttribute('data-index'));
        showSlide_{{ section.id }}(index);
      });
    });

    {% if section.settings.enable_media_autoplay %}
      let autoplayInterval_{{ section.id }};
      
      function startAutoplay_{{ section.id }}() {
        clearInterval(autoplayInterval_{{ section.id }}); 
        autoplayInterval_{{ section.id }} = setInterval(() => {
          let nextIndex = (currentIndex_{{ section.id }} + 1) % slides_{{ section.id }}.length;
          showSlide_{{ section.id }}(nextIndex);
        }, 5000);
      }
      
      startAutoplay_{{ section.id }}();
      
      slidesContainer_{{ section.id }}.addEventListener('mouseenter', () => clearInterval(autoplayInterval_{{ section.id }}));
      slidesContainer_{{ section.id }}.addEventListener('mouseleave', startAutoplay_{{ section.id }});
      dotsContainer_{{ section.id }}.addEventListener('click', () => {
        clearInterval(autoplayInterval_{{ section.id }});
        startAutoplay_{{ section.id }}();
      });
    {% endif %}

    showSlide_{{ section.id }}(0);
  }

  // Quantity Selector Logic
  document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.getElementById('quantity-{{ section.id }}');
    const minusButton = quantityInput ? quantityInput.previousElementSibling : null;
    const plusButton = quantityInput ? quantityInput.nextElementSibling : null;

    if (quantityInput && minusButton && plusButton) {
      minusButton.addEventListener('click', () => {
        let currentValue = parseInt(quantityInput.value);
        if (currentValue > parseInt(quantityInput.min)) {
          quantityInput.value = currentValue - 1;
        }
      });

      plusButton.addEventListener('click', () => {
        let currentValue = parseInt(quantityInput.value);
        quantityInput.value = currentValue + 1;
      });

      quantityInput.addEventListener('change', () => {
        let value = parseInt(quantityInput.value);
        if (isNaN(value) || value < parseInt(quantityInput.min)) {
          quantityInput.value = parseInt(quantityInput.min);
        }
      });
    }
  });
</script>

{% schema %}
  {
    "name": "Featured Product",
    "tag": "section",
    "class": "section-featured-product",
    "settings": [
      {
        "type": "header",
        "content": "Color Scheme"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "Color scheme",
        "default": "scheme_1"
      },
      {
        "type": "header",
        "content": "Product Selection"
      },
      {
        "type": "product",
        "id": "product",
        "label": "Product",
        "info": "Select a product to feature."
      }, {
        "type": "header",
        "content": "Section Header"
      }, {
        "type": "text",
        "id": "subheading",
        "label": "Subheading",
        "default": "OUR SELECTION"
      }, {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "PRODUCT OF THE WEEK"
      }, {
        "type": "header",
        "content": "Layout Settings"
      }, {
        "type": "select",
        "id": "section_width",
        "label": "Section width",
        "default": "large",
        "options": [
          {
            "value": "large",
            "label": "Large (1200px)"
          }, {
            "value": "x-large",
            "label": "X-Large (1400px)"
          }, {
            "value": "full",
            "label": "Full width"
          }
        ]
      }, {
        "type": "range",
        "id": "product_info_width",
        "min": 30,
        "max": 70,
        "step": 5,
        "unit": "%",
        "label": "Product info width (desktop)",
        "default": 50,
        "info": "Product media will fill the remaining space."
      }, {
        "type": "checkbox",
        "id": "center_mobile_info",
        "label": "Center basic info on mobile",
        "default": true,
        "info": "Includes title, vendor, price, and rating (if available)."
      }, {
        "type": "header",
        "content": "Media Display"
      }, {
        "type": "checkbox",
        "id": "enable_media_autoplay",
        "label": "Enable media autoplay",
        "default": false
      }, {
        "type": "checkbox",
        "id": "enable_video_looping",
        "label": "Enable video looping",
        "default": true
      }
    ],
    "presets": [
      {
        "name": "Featured Product",
        "category": "Product"
      }
    ]
  }
{% endschema %}