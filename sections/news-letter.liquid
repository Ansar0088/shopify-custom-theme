<style>
  /* Load Inter font as fallback */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

  /* --- General Section Styles --- */
  .section-{{ section.id }} {
    position: relative;
    /* Section background uses theme color scheme */
    background-color: var(--color-background);
    /* Text color uses theme color scheme */
    color: var(--color-primary-text);
    padding: 100px 20px;
    text-align: center;
    overflow: hidden;
  }

  {% if section.settings.separator %}
    .section-{{ section.id }} {
      border-top: 1px solid rgba(var(--color-primary-text-rgb, 255, 255, 255), 0.1);
    }
  {% endif %}

  /* --- Background and Overlay --- */
  .newsletter-background {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    /* Background color uses theme */
    background-color: var(--color-background);
  }

  .newsletter-background-image {
    width: 100%;
    height: 100%;
    object-fit: {{ section.settings.image_size }};
  }

  .newsletter-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: {{ section.settings.overlay_color }};
    opacity: {{ section.settings.overlay_opacity | divided_by: 100.0 }};
    z-index: 2;
  }

  /* --- Content Box --- */
  .newsletter-content {
    position: relative;
    z-index: 3;
    max-width: 600px;
    margin: 0 auto;
  }

  /* Apply theme font families if they exist */
  .newsletter-subheading,
  .newsletter-heading,
  .newsletter-body,
  .newsletter-input,
  .newsletter-button {
    {% if settings.font_heading %}
      font-family: {{ settings.font_heading.family }}, 
      {{ settings.font_heading.fallback_families }}
      , 'Inter'
      , sans-serif;
    {% else %}
      font-family: 'Inter'
      , sans-serif;
    {% endif %}
  }

  /* Body font for body text */
  .newsletter-body,
  .newsletter-input,
  .newsletter-button {
    {% if settings.font_body %}
      font-family: {{ settings.font_body.family }}, 
      {{ settings.font_body.fallback_families }}
      , 'Inter'
      , sans-serif;
    {% endif %}
  }

  /* --- Typography Styles --- */
  .newsletter-subheading {
    font-size: {{ settings.font_size_small | default: 12 }}px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 5px;
    color: var(--color-secondary-text);
    font-weight: {{ settings.font_weight_medium | default: 500 }};
  }

  .newsletter-heading {
    font-size: {{ settings.font_size_heading_large | default: 36 }}px;
    font-weight: {{ settings.font_weight_normal | default: 400 }};
    text-transform: uppercase;
    margin-bottom: 25px;
    color: var(--color-header-text);
  }

  .newsletter-body {
    font-size: {{ settings.font_size_base | default: 16 }}px;
    line-height: {{ settings.body_line_height | default: 1.5 }};
    max-width: 450px;
    margin: 0 auto 35px;
    color: var(--color-primary-text);
    font-weight: {{ settings.font_weight_normal | default: 400 }};
  }

  /* --- Form Styles --- */
  .newsletter-form {
    display: flex;
    justify-content: center;
    gap: 15px;
    width: 100%;
  }

  .newsletter-input {
    flex-grow: 1;
    max-width: 300px;
    height: 48px;
    padding: 12px 15px;
    /* Input border uses theme link color */
    border: 1px solid var(--color-link);
    background-color: transparent;
    /* Input text color uses theme */
    color: var(--color-primary-text);
    font-size: {{ settings.font_size_base | default: 16 | times: 0.95 }}px;
    transition: border-color 0.3s;
  }

  .newsletter-input:focus {
    outline: none;
    border-color: var(--color-button-filled);
  }

  .newsletter-input::placeholder {
    color: var(--color-secondary-text);
    opacity: 0.7;
  }

  .newsletter-button {
    height: 48px;
    padding: 0 30px;
    /* Button border uses theme button color */
    border: 1px solid var(--color-button-filled);
    /* Button background uses theme button color */
    background-color: var(--color-button-filled);
    /* Button text color uses theme button label color */
    color: var(--color-button-filled-label);
    font-size: {{ settings.font_size_base | default: 16 | times: 0.95 }}px;
    font-weight: {{ settings.font_weight_medium | default: 500 }};
    text-transform: uppercase;
    cursor: pointer;
    transition: background-color 0.3s
    , color 0.3s
    , opacity 0.3s;
  }

  /* Button Hover State */
  .newsletter-button:hover {
    opacity: 0.9;
  }

  /* Form Messages */
  .form-success {
    margin-top: 20px !important;
    color: var(--color-link) !important;
    font-size: {{ settings.font_size_base | default: 16 }}px;
    font-weight: {{ settings.font_weight_medium | default: 500 }};
  }

  .form-error {
    margin-top: 20px !important;
    color: #ff5555 !important;
    font-size: {{ settings.font_size_base | default: 16 }}px;
    font-weight: {{ settings.font_weight_medium | default: 500 }};
  }

  /* --- Mobile Responsiveness --- */
  @media (max-width: 600px) {
    .section-{{ section.id }} {
      padding: 70px 20px;
    }

    .newsletter-heading {
      font-size: {{ settings.font_size_heading_medium | default: 28 }}px;
    }

    .newsletter-body {
      font-size: {{ settings.font_size_base | default: 16 | times: 0.9 }}px;
      margin-bottom: 25px;
    }

    .newsletter-form {
      flex-direction: column;
      gap: 10px;
    }

    .newsletter-input,
    .newsletter-button {
      max-width: 100%;
      width: 100%;
    }
  }
</style>

<section class="section-{{ section.id }} color-{{ section.settings.color_scheme.id | default: settings.color_schemes.first.id }}">
  <div class="newsletter-background">
    {% if section.settings.image != blank %}
      {% assign desktop_image = section.settings.image %}
      {% assign mobile_image = section.settings.mobile_image | default: desktop_image %}

      <picture>
        {% if mobile_image != blank %}
          <source media="(max-width: 767px)" srcset="{{ mobile_image | img_url: '750x' }}">
        {% endif %}

        <img
          src="{{ desktop_image | img_url: '1500x' }}"
          alt="{{ section.settings.heading | escape }}"
          class="newsletter-background-image"
          loading="lazy"
          width=""
          height="">
      </picture>
    {% endif %}
  </div>

  {% if section.settings.overlay_opacity > 0 %}
    <div class="newsletter-overlay"></div>
  {% endif %}

  <div class="newsletter-content">
    {% if section.settings.subheading != blank %}
      <p class="newsletter-subheading">
        {{ section.settings.subheading | escape }}
      </p>
    {% endif %}

    <h2 class="newsletter-heading">
      {{ section.settings.heading | escape }}
    </h2>

    {% if section.settings.content != blank %}
      <div class="newsletter-body">
        {{ section.settings.content }}
      </div>
    {% endif %}

    {% form 'customer' %}
      <input
        type="hidden"
        name="contact[tags]"
        value="newsletter">

      <div class="newsletter-form">
        <input
          type="email"
          name="contact[email]"
          id="NewsletterForm--{{ section.id }}"
          class="newsletter-input"
          value="{{ form.email }}"
          placeholder="{{ section.settings.placeholder_text | default: 'E-mail' }}"
          required
          aria-required="true"
          autocorrect="off"
          autocapitalize="off">
        <button
          type="submit"
          name="commit"
          id="Subscribe"
          class="newsletter-button">
          {{ section.settings.button_text | default: 'Subscribe' | escape }}
        </button>
      </div>

      {% comment %} Display success or error messages {% endcomment %}
      {% if form.posted_successfully? %}
        <p class="form-success">
          {{ section.settings.success_message | default: 'Thank you for subscribing!' }}
        </p>
      {% elsif form.errors %}
        <p class="form-error">
          {{ form.errors | default_errors }}
        </p>
      {% endif %}
    {% endform %}
  </div>
</section>

{% schema %}
  {
    "name": "Newsletter",
    "tag": "section",
    "class": "section-newsletter",
    "settings": [
      {
        "type": "header",
        "content": "Color Scheme"
      },
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "Color scheme",
        "default": "scheme_1"
      },
      {
        "type": "header",
        "content": "Text Content"
      },
      {
        "type": "text",
        "id": "subheading",
        "label": "Subheading",
        "default": "Keep me updated"
      }, {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Newsletter"
      }, {
        "type": "richtext",
        "id": "content",
        "label": "Short Description",
        "default": "<p>Subscribe to get notified about product launches, special offers and company news.</p>",
        "info": "This text appears just above the email input field."
      }, {
        "type": "text",
        "id": "placeholder_text",
        "label": "Input placeholder text",
        "default": "E-mail"
      }, {
        "type": "text",
        "id": "button_text",
        "label": "Button text",
        "default": "Subscribe"
      }, {
        "type": "text",
        "id": "success_message",
        "label": "Success message",
        "default": "Thank you for subscribing!"
      }, {
        "type": "header",
        "content": "Background & Design"
      }, {
        "type": "checkbox",
        "id": "separator",
        "label": "Separate section with border",
        "default": false
      }, {
        "type": "image_picker",
        "id": "image",
        "label": "Desktop Background Image",
        "info": "2000 x 1000px recommended"
      }, {
        "type": "image_picker",
        "id": "mobile_image",
        "label": "Mobile Background Image",
        "info": "1100 x 1500px recommended. Default to desktop image."
      }, {
        "type": "select",
        "id": "image_size",
        "label": "Image size",
        "options": [
          {
            "value": "cover",
            "label": "Fit screen (Cover)"
          }, {
            "value": "contain",
            "label": "Original image ratio (Contain)"
          }, {
            "value": "auto",
            "label": "Original size (Auto)"
          }
        ],
        "default": "cover",
        "info": "Choose 'Original image ratio' to avoid image cropping."
      }, {
        "type": "color",
        "id": "overlay_color",
        "label": "Overlay color",
        "default": "#000000"
      }, {
        "type": "range",
        "id": "overlay_opacity",
        "min": 0,
        "max": 100,
        "step": 5,
        "unit": "%",
        "label": "Overlay opacity",
        "default": 0
      }
    ],
    "presets": [
      {
        "name": "Newsletter Signup",
        "category": "Marketing"
      }
    ]
  }
{% endschema %}