{% comment %}
  Shopify Hero Slideshow Section
  -------------------------------
  - **NEW:** Added Left/Right navigation arrows (buttons).
  - **NEW:** Added 'Show Navigation Arrows' toggle to schema.
  - FIXED Autoplay functionality in JS.
  - FIXED Indicator dot styling to match the user's image (outlined inactive, pill-shaped active).
  - Supports multiple slides as blocks with per-slide style and alignment settings
  - All content, timing, and colors are dynamic via schema settings
  - Implements smooth fade/scale animations for transitions
{% endcomment %}

{% comment %} Add Font Awesome for Icons {% endcomment %}
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  integrity="sha512-..."
  crossorigin="anonymous"
  referrerpolicy="no-referrer" />

{% style %}
  /* --- BASE STYLES & RESET --- */
  .hero-slideshow-{{ section.id }} {
    height: 60vh;
    /* Shorter, impactful hero height */
    width: 100%;
    min-height: 500px;
    /* Ensures a minimum height */
    overflow: hidden;
    position: relative;
  }

  /* Slide container styles */
  .slide-item {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
    /* Use flex to control alignment */
  }

  .slide-item.active {
    opacity: 1;
    z-index: 5;
  }

  /* --- IMAGE ZOOM EFFECT (Ken Burns Effect) --- */
  .slide-bg-image {
    transform: scale(1.05);
    transition: transform 8s ease-out;
  }

  .slide-item.active .slide-bg-image {
    transform: scale(1.0);
  }

  /* --- CONTENT STYLING (CONDITIONAL) --- */

  /* This wrapper handles the alignment (flex properties) */.slide-content-alignment-wrapper {
    position: relative;
    z-index: 20;
    padding: 2rem 1.5rem;
    /* Base padding */
    width: 100%;
    height: 100%;
    display: flex;
  }

  /* This wrapper handles the text alignment and max-width */
  .slide-content-wrapper {
    max-width: 90%;
    width: 100%;
    margin: 0;
    /* Margin is controlled by flex alignment */
  }

  /* 1. Boxed Style (Border Removed, now just a padded overlay) */
  .content-box {
    padding: 3.5rem 5rem;
    backdrop-filter: blur(2px);
    background-color: rgba(0, 0, 0, 0.08);
    max-width: 800px;
    /* Max width for the box */
  }

  /* 2. Standard Style */
  .slide-content-wrapper:not(.content-box) {
    max-width: 900px;
    /* Standard content can be wider */
  }

  /* Alignment classes (Apply to slide-content-alignment-wrapper) */
  .align-top-left {
    justify-content: flex-start;
    align-items: flex-start;
  }
  .align-top-center {
    justify-content: center;
    align-items: flex-start;
  }
  .align-top-right {
    justify-content: flex-end;
    align-items: flex-start;
  }
  .align-middle-left {
    justify-content: flex-start;
    align-items: center;
  }
  .align-middle-center {
    justify-content: center;
    align-items: center;
  }
  .align-middle-right {
    justify-content: flex-end;
    align-items: center;
  }
  .align-bottom-left {
    justify-content: flex-start;
    align-items: flex-end;
  }
  .align-bottom-center {
    justify-content: center;
    align-items: flex-end;
  }
  .align-bottom-right {
    justify-content: flex-end;
    align-items: flex-end;
  }

  /* Text alignment classes (Apply to slide-content-wrapper) */
  .text-pos-left {
    text-align: left;
    margin-left: 0;
    margin-right: auto;
  }
  .text-pos-center {
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }
  .text-pos-right {
    text-align: right;
    margin-left: auto;
    margin-right: 0;
  }

  /* --- SLIDE INDICATORS (DOTS) --- */
  .slide-indicators-container {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 20;
    opacity: 1 !important;
    visibility: visible !important;
  }

  .slide-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease
    , width 0.3s ease;
    /* Added width transition */

    /* Inactive state is OUTLINED (White border, transparent center) */
    border: 2px solid{{ section.settings.indicator_color }};
    background-color: transparent;

    /* Ensure all dots start at the same width */
    transform: scale(1.0);
  }

  .slide-indicator.active {
    /* Active state is FILLED and WIDER (Pill shape) */
    background-color: {{ section.settings.indicator_color }};
    border-color: {{ section.settings.indicator_color }};

    /* Make it wider to achieve the pill/squashed circle look */
    width: 28px;
    border-radius: 6px;
    /* A slight rounding for the pill shape */

    /* Reset scale if used elsewhere, focusing on width/border-radius change */
    transform: scale(1.0);
  }

  .slide-indicator:hover:not(.active) {
    /* Subtle hover effect on inactive dots */
    background-color: {{ section.settings.indicator_color | color_modify: 'alpha', 0.2 }};
  }

  /* --- NAVIGATION ARROWS (NEW CSS) --- */
  .slide-nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 30;
    /* Above content and overlay */
    background: transparent;
    border: none;
    cursor: pointer;
    color: {{ section.settings.indicator_color }};
    font-size: 2.5rem;
    opacity: 0.7;
    padding: 1rem;
    transition: opacity 0.3s
    , color 0.3s;
    /* Hide if setting is disabled */
    {% unless section.settings.show_navigation_arrows %}
      display: none;
    {% endunless %}
  }

  .slide-nav-arrow:hover {
    opacity: 1;
    /* Slightly increase size on hover */
    transform: translateY(-50%) scale(1.1);
  }

  .slide-nav-arrow.prev {
    left: 10px;
  }

  .slide-nav-arrow.next {
    right: 10px;
  }

  /* Mobile adjustments */
  @media (max-width: 768px) {
    .content-box {
      padding: 2rem 1.5rem;
      max-width: 100%;
    }
    .slide-content-alignment-wrapper {
      padding: 1.5rem;
      /* On mobile, force center alignment for better readability */
      justify-content: center;
      align-items: center;
    }
    .slide-content-wrapper {
      /* On mobile, force center text for better readability */
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .slide-indicators-container {
      bottom: 20px;
    }

    .slide-indicator {
      height: 10px;
      width: 10px;
    }
    .slide-indicator.active {
      width: 24px;
      height: 10px;
    }

    /* Smaller arrows on mobile */
    .slide-nav-arrow {
      font-size: 1.8rem;
      padding: 0.5rem;
    }
  }

  /* --- TYPOGRAPHY UPDATES --- */
  .slide-content-wrapper .subheading {
    font-size: 0.95rem;
    letter-spacing: 4px;
    font-weight: 500;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }
  .slide-content-wrapper .heading {
    font-size: clamp(2.5rem, 5vw, 4rem);
    /* Responsive font size */
    font-weight: 700;
    line-height: 1.1;
    margin-bottom: 20px;
    text-transform: uppercase;
  }
  .slide-content-wrapper .text {
    font-size: 1.1rem;
    margin-bottom: 30px;
  }

  /* --- ANIMATIONS (Text Fade/Scale) --- */
  @keyframes slideInText {
    0% {
      opacity: 0;
      transform: translateY(15px) scale(0.98);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .slide-item.active .slide-content-wrapper {
    animation: slideInText 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.2s forwards;
    /* Added 0.2s delay */
    opacity: 0;
    /* Start as hidden for animation */
  }

  /* Button Styles */
  .button-primary {
    transition: background-color 0.3s
    , color 0.3s
    , border-color 0.3s
    , opacity 0.3s;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    border-radius: 0;
  }
{% endstyle %}

<section class="hero-slideshow-{{ section.id }} relative" style="font-family: {{ section.settings.font_family }};">
  {% liquid
    assign indicator_count = section.blocks.size
  %}

  {% for block in section.blocks %}
    {% liquid
      assign block_image = block.settings.image
      assign block_mobile_image = block.settings.mobile_image
      assign overlay_color = block.settings.overlay_color
      assign overlay_opacity = block.settings.overlay_opacity | times: 0.01
      assign text_color = block.settings.text_color

      assign content_style = block.settings.content_style
      assign content_position = block.settings.content_position

      assign content_style_class = ''
      if content_style == 'boxed'
        assign content_style_class = 'content-box'
      endif

      comment
        Apply alignment classes based on the 'content_position' setting
      endcomment
      assign alignment_class = 'align-' | append: content_position | replace: '_', '-'

      assign text_align_class = ''
      if content_position contains 'left'
        assign text_align_class = 'text-pos-left'
      elsif content_position contains 'center'
        assign text_align_class = 'text-pos-center'
      elsif content_position contains 'right'
        assign text_align_class = 'text-pos-right'
      endif
    %}

    <div
      class="slide-item slide-{{ block.id }} {% if forloop.first %}active{% endif %}"
      data-slide-id="{{ block.id }}"
      data-index="{{ forloop.index0 }}"
      {{ block.shopify_attributes }}
      style="color: {{ text_color }};">
      <div class="absolute inset-0 z-10" style="background-color: {{ overlay_color | color_modify: 'alpha', overlay_opacity }};"></div>

      <div class="slide-bg-image absolute inset-0 w-full h-full z-0 bg-cover bg-center" style="
          background-image: url('{{ block_image | image_url: width: 1920 }}');
        ">
        {% if block_mobile_image != blank %}
          <style>
            @media (max-width: 768px) {
              .slide-{{ block.id }}> .slide-bg-image {
                background-image: url('{{ block_mobile_image | image_url: width: 800 }}') !important;
              }
            }
          </style>
        {% endif %}
      </div>

      <div class="slide-content-alignment-wrapper {{ alignment_class }}">

        <div class="slide-content-wrapper {{ text_align_class }} {{ content_style_class }}">

          {% if block.settings.subheading != blank %}
            <p class="subheading mb-2">
              {{ block.settings.subheading | escape }}
            </p>
          {% endif %}

          {% if block.settings.heading != blank %}
            <h2 class="heading font-extrabold mb-4">
              {{ block.settings.heading | escape }}
            </h2>
          {% endif %}

          {% if block.settings.text != blank %}
            <div class="text mb-8">
              {{ block.settings.text }}
            </div>
          {% endif %}

          {% if block.settings.button_label_1 != blank or block.settings.button_label_2 != blank %}
            <div class="mt-8 space-x-4">

              {% liquid
                assign button_label_1 = block.settings.button_label_1
                assign button_link_1 = block.settings.button_link_1
                assign button_style_setting_1 = block.settings.button_style
                assign button_text_color_1 = text_color
                assign button_bg_color_1 = block.settings.button_background_1

                assign style_attr_1 = ''
                assign button_class_1 = ''

                case button_style_setting_1
                  when 'outline'
                    assign button_class_1 = 'bg-transparent border-2 hover:bg-white hover:text-black'
                    capture style_attr_1
                      echo 'border-color:' | append: button_text_color_1 | append: '; color:' | append: button_text_color_1
                    endcapture
                  when 'solid'
                    assign button_class_1 = 'border-2 border-transparent text-black hover:opacity-80'
                    capture style_attr_1
                      echo 'background-color:' | append: button_bg_color_1 | append: '; color:' | append: button_text_color_1
                    endcapture
                  when 'link'
                    assign button_class_1 = 'bg-transparent border-transparent underline hover:opacity-80'
                    capture style_attr_1
                      echo 'color:' | append: button_text_color_1
                    endcapture
                endcase
              %}

              {% if button_label_1 != blank and button_link_1 != blank %}
                <a
                  href="{{ button_link_1 }}"
                  class="button-primary inline-block font-medium py-3 px-8 transition {{ button_class_1 }}"
                  style="{{ style_attr_1 }}"
                  role="button">
                  {{ button_label_1 | escape }}
                </a>
              {% endif %}

              {% liquid
                assign button_label_2 = block.settings.button_label_2
                assign button_link_2 = block.settings.button_link_2
                assign button_style_setting_2 = block.settings.button_style_2
                assign button_text_color_2 = block.settings.button_text_2
                assign button_bg_color_2 = block.settings.button_background_2

                assign style_attr_2 = ''
                assign button_class_2 = ''

                case button_style_setting_2
                  when 'outline'
                    assign button_class_2 = 'bg-transparent border-2 hover:bg-white hover:text-black'
                    capture style_attr_2
                      echo 'border-color:' | append: button_text_color_2 | append: '; color:' | append: button_text_color_2
                    endcapture
                  when 'solid'
                    assign button_class_2 = 'border-2 border-transparent text-black hover:opacity-80'
                    capture style_attr_2
                      echo 'background-color:' | append: button_bg_color_2 | append: '; color:' | append: button_text_color_2
                    endcapture
                  when 'link'
                    assign button_class_2 = 'bg-transparent border-transparent underline hover:opacity-80'
                    capture style_attr_2
                      echo 'color:' | append: button_text_color_2
                    endcapture
                endcase
              %}

              {% if button_label_2 != blank and button_link_2 != blank %}
                <a
                  href="{{ button_link_2 }}"
                  class="button-primary inline-block font-medium py-3 px-8 transition {{ button_class_2 }}"
                  style="{{ style_attr_2 }}"
                  role="button">
                  {{ button_label_2 | escape }}
                </a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endfor %}

  {% if indicator_count > 1 %}
    {% comment %} NAVIGATION ARROWS {% endcomment %}
    {% if section.settings.show_navigation_arrows and indicator_count > 1 %}
      <button
        class="slide-nav-arrow prev"
        aria-label="Previous slide"
        id="slide-prev-{{ section.id }}">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button
        class="slide-nav-arrow next"
        aria-label="Next slide"
        id="slide-next-{{ section.id }}">
        <i class="fas fa-chevron-right"></i>
      </button>
    {% endif %}

    {% comment %} INDICATOR DOTS {% endcomment %}
    <div class="slide-indicators-container">
      {% for block in section.blocks %}
        <span
          class="slide-indicator {% if forloop.first %}active{% endif %}"
          data-index="{{ forloop.index0 }}"
          aria-label="Go to slide {{ forloop.index }}"
          role="button"
          tabindex="0"></span>
      {% endfor %}
    </div>
  {% endif %}
</section>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const sectionElement = document.querySelector(`.hero-slideshow-${sectionId}`);
    if (!sectionElement) return;

    const slides = sectionElement.querySelectorAll('.slide-item');
    const slideIndicators = sectionElement.querySelectorAll('.slide-indicator');
    const prevButton = document.getElementById(`slide-prev-${sectionId}`);
    const nextButton = document.getElementById(`slide-next-${sectionId}`);
    
    // Rotation speed is read from the schema setting in milliseconds
    const rotationSpeed = parseInt('{{ section.settings.rotation_speed | times: 1000 }}', 10);

    let currentSlideIndex = 0;
    let slideInterval = null;

    if (slides.length <= 1) return; 

    function updateIndicators(index) {
      slideIndicators.forEach((indicator, i) => {
        indicator.classList.toggle('active', i === index);
      });
    }

    function showSlide(index) {
      if (index >= slides.length) index = 0;
      if (index < 0) index = slides.length - 1;

      slides.forEach((slide) => {
        slide.classList.remove('active');
      });

      const newSlide = slides[index];
      if (newSlide) {
        // Set the active class
        newSlide.classList.add('active');
      }

      updateIndicators(index);
      currentSlideIndex = index;
    }

    function nextSlide() {
      showSlide(currentSlideIndex + 1);
    }

    function prevSlide() {
      showSlide(currentSlideIndex - 1);
    }


    // Function to start or restart the auto-rotation interval
    const startRotation = () => {
        if (slideInterval) clearInterval(slideInterval);
        if (rotationSpeed > 0) {
            slideInterval = setInterval(nextSlide, rotationSpeed);
        }
    };

    // 1. Initialize the slideshow and start rotation
    showSlide(0);
    startRotation(); // Start the rotation immediately if rotationSpeed > 0

    // --- Arrow Button Functionality (NEW) ---
    if (prevButton && nextButton) {
      prevButton.addEventListener('click', () => {
        prevSlide();
        startRotation(); // Reset the interval on user interaction
      });

      nextButton.addEventListener('click', () => {
        nextSlide();
        startRotation(); // Reset the interval on user interaction
      });
    }


    // Add click events to indicators (and reset interval)
    slideIndicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            if (index !== currentSlideIndex) {
                showSlide(index);
                startRotation(); // Reset the interval on user interaction
            }
        });
        
        // Add keyboard support for accessibility
        indicator.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                if (index !== currentSlideIndex) {
                    showSlide(index);
                    startRotation();
                }
            }
        });
    });

    // Pause auto-rotation on hover for better UX
    sectionElement.addEventListener('mouseenter', () => {
        if (slideInterval) {
            clearInterval(slideInterval);
        }
    });

    sectionElement.addEventListener('mouseleave', () => {
        // Only restart if the interval was running before (i.e., rotationSpeed > 0)
        startRotation();
    });
  })();
</script>

{% schema %}
  {
    "name": "Hero Slideshow",
    "tag": "section",
    "class": "section-slideshow",
    "max_blocks": 5,
    "settings": [
      {
        "type": "range",
        "id": "rotation_speed",
        "min": 0,
        "max": 30,
        "step": 1,
        "unit": "sec",
        "label": "Auto rotate between slides",
        "default": 6,
        "info": "Set to 0 to disable auto rotation. Max time is 30 seconds."
      },
      {
        "type": "header",
        "content": "Navigation Settings"
      },
      {
        "type": "checkbox",
        "id": "show_navigation_arrows",
        "label": "Show Left/Right Arrows",
        "default": true
      },
      {
        "type": "header",
        "content": "Visual Settings"
      }, {
        "type": "select",
        "id": "font_family",
        "label": "Font Family",
        "default": "sans-serif",
        "options": [
          {
            "value": "serif",
            "label": "Serif"
          }, {
            "value": "sans-serif",
            "label": "Sans Serif"
          }
        ]
      }, {
        "type": "color",
        "id": "indicator_color",
        "label": "Indicator/Arrow Color",
        "default": "#FFFFFF",
        "info": "Color for the active slide indicator dots and navigation arrows."
      }
    ],
    "blocks": [
      {
        "type": "slide",
        "name": "Slide",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Desktop image",
            "info": "1920 x 1080px recommended"
          },
          {
            "type": "image_picker",
            "id": "mobile_image",
            "label": "Mobile image (Optional)",
            "info": "768 x 1200px recommended"
          },
          {
            "type": "header",
            "content": "Content"
          },
          {
            "type": "select",
            "id": "content_style",
            "label": "Content Style",
            "default": "default",
            "options": [
              {
                "value": "default",
                "label": "Standard (Text Only)"
              }, {
                "value": "boxed",
                "label": "Boxed Content (No Border)"
              }
            ]
          }, {
            "type": "text",
            "id": "subheading",
            "label": "Subheading",
            "default": "Our latest collection"
          }, {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "Elegant & Timeless"
          }, {
            "type": "richtext",
            "id": "text",
            "label": "Text",
            "default": "<p>Discover the finest handcrafted goods.</p>"
          }, {
            "type": "select",
            "id": "content_position",
            "label": "Content position",
            "default": "middle_center",
            "info": "Controls the alignment for both 'Standard' and 'Boxed' styles on desktop. (Mobile is always centered).",
            "options": [
              {
                "value": "top_left",
                "label": "Top left"
              },
              {
                "value": "top_center",
                "label": "Top center"
              },
              {
                "value": "top_right",
                "label": "Top right"
              },
              {
                "value": "middle_left",
                "label": "Middle left"
              }, {
                "value": "middle_center",
                "label": "Middle center"
              }, {
                "value": "middle_right",
                "label": "Middle right"
              }, {
                "value": "bottom_left",
                "label": "Bottom left"
              }, {
                "value": "bottom_center",
                "label": "Bottom center"
              }, {
                "value": "bottom_right",
                "label": "Bottom right"
              }
            ]
          }, {
            "type": "header",
            "content": "Colors & Overlay"
          }, {
            "type": "color",
            "id": "text_color",
            "label": "Text Color",
            "default": "#FFFFFF"
          }, {
            "type": "color",
            "id": "overlay_color",
            "label": "Overlay Color",
            "default": "#000000"
          }, {
            "type": "range",
            "id": "overlay_opacity",
            "min": 0,
            "max": 100,
            "step": 5,
            "unit": "%",
            "label": "Overlay Opacity",
            "default": 30
          }, {
            "type": "header",
            "content": "Button 1"
          }, {
            "type": "text",
            "id": "button_label_1",
            "label": "Text",
            "default": "Shop Now"
          }, {
            "type": "url",
            "id": "button_link_1",
            "label": "Link"
          }, {
            "type": "select",
            "id": "button_style",
            "label": "Style",
            "default": "outline",
            "options": [
              {
                "value": "outline",
                "label": "Outline"
              }, {
                "value": "solid",
                "label": "Solid"
              }, {
                "value": "link",
                "label": "Link"
              }
            ]
          }, {
            "type": "color",
            "id": "button_background_1",
            "label": "Solid Button Background",
            "default": "#FFFFFF",
            "info": "Only applies to Solid style."
          }, {
            "type": "header",
            "content": "Button 2 (Optional)"
          }, {
            "type": "text",
            "id": "button_label_2",
            "label": "Text"
          }, {
            "type": "url",
            "id": "button_link_2",
            "label": "Link"
          }, {
            "type": "select",
            "id": "button_style_2",
            "label": "Style",
            "default": "solid",
            "options": [
              {
                "value": "outline",
                "label": "Outline"
              }, {
                "value": "solid",
                "label": "Solid"
              }, {
                "value": "link",
                "label": "Link"
              }
            ]
          }, {
            "type": "color",
            "id": "button_background_2",
            "label": "Solid Button Background",
            "default": "#1C1C1C",
            "info": "Only applies to Solid style."
          }, {
            "type": "color",
            "id": "button_text_2",
            "label": "Solid Button Text Color",
            "default": "#FFFFFF",
            "info": "Only applies to Solid style."
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Full-width Slideshow",
        "blocks": [
          {
            "type": "slide"
          }, {
            "type": "slide"
          }
        ]
      }
    ]
  }
{% endschema %}