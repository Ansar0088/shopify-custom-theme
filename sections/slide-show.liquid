{% comment %}
  Shopify Hero Slideshow Section - Exact Match to Reference Image
  ----------------------------------------------------------------
{% endcomment %}

{% style %}
  /* --- BASE STYLES & RESET --- */
  .hero-slideshow-{{ section.id }} {
    height: 60vh;
    width: 100%;
    min-height: 500px;
    overflow: hidden;
    position: relative;
  }

  /* Slide container styles */
  .slide-item {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.8s ease-in-out;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    display: flex;
  }

  .slide-item.active {
    opacity: 1;
    z-index: 5;
  }

  /* --- IMAGE ZOOM EFFECT --- */
  .slide-bg-image {
    transform: scale(1.05);
    transition: transform 8s ease-out;
  }

  .slide-item.active .slide-bg-image {
    transform: scale(1.0);
  }

  /* --- CONTENT STYLING --- */
  .slide-content-alignment-wrapper {
    position: relative;
    z-index: 20;
    padding: 2rem 1.5rem;
    width: 100%;
    height: 100%;
    display: flex;
  }

  .slide-content-wrapper {
    max-width: 90%;
    width: 100%;
    margin: 0;
  }

  /* Boxed Style - EXACT MATCH TO IMAGE */
  .content-box {
    padding: 3rem 4rem;
    max-width: 500px;
    border: 1px solid rgba(255, 255, 255, 0.6);
    background-color: transparent;
  }

  /* Standard Style */
  .slide-content-wrapper:not(.content-box) {
    max-width: 900px;
  }

  /* Alignment classes */
  .align-top-left {
    justify-content: flex-start;
    align-items: flex-start;
  }
  .align-top-center {
    justify-content: center;
    align-items: flex-start;
  }
  .align-top-right {
    justify-content: flex-end;
    align-items: flex-start;
  }
  .align-middle-left {
    justify-content: flex-start;
    align-items: center;
  }
  .align-middle-center {
    justify-content: center;
    align-items: center;
  }
  .align-middle-right {
    justify-content: flex-end;
    align-items: center;
  }
  .align-bottom-left {
    justify-content: flex-start;
    align-items: flex-end;
  }
  .align-bottom-center {
    justify-content: center;
    align-items: flex-end;
  }
  .align-bottom-right {
    justify-content: flex-end;
    align-items: flex-end;
  }

  /* Text alignment classes */
  .text-pos-left {
    text-align: left;
    margin-left: 0;
    margin-right: auto;
  }
  .text-pos-center {
    text-align: center;
    margin-left: auto;
    margin-right: auto;
  }
  .text-pos-right {
    text-align: right;
    margin-left: auto;
    margin-right: 0;
  }

  /* --- TYPOGRAPHY - EXACT MATCH TO IMAGE --- */
  .slide-content-wrapper .subheading {
    {% if settings.type_header_family != blank %}
      font-family: {{ settings.type_header_family.family }}, 
      {{ settings.type_header_family.fallback_families }};
    {% endif %}
    font-size: var(--font-base-size);
    font-weight: 400;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 1.5rem;
    line-height: 1.4;
    opacity: 0.95;
  }

  .slide-content-wrapper .heading {
    font-family: var(--font-heading-family);
    font-size: var(--font-size-heading-large);
    font-weight: 300;
    line-height: 1.2;
    margin-bottom: 2rem;
    text-transform: uppercase;
    letter-spacing: 5px;
  }

  .slide-content-wrapper .text {
    {% if settings.type_body_family != blank %}
      font-family: {{ settings.type_body_family.family }}, 
      {{ settings.type_body_family.fallback_families }};
    {% endif %}
    font-size: 16px;
    font-weight: {{ settings.type_body_weight }};
    line-height: {{ settings.type_body_line_height }};
    margin-bottom: 30px;
    display: none;
  }

  /* Button Styles - EXACT MATCH TO IMAGE */
  .button-primary {
    {% if settings.type_button_family != blank %}
      font-family: {{ settings.type_button_family.family }}, 
      {{ settings.type_button_family.fallback_families }};
    {% endif %}
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    border-radius: 0;
    padding: 16px 40px !important;
    display: inline-block;
    border: none;
    background-color: #FFFFFF;
    color: #1a1a1a;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  /* Button Hover Animation - Smooth Left to Right Effect */
  .button-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.7s ease;
    z-index: 1;
  }

  .button-primary:hover::before {
    left: 100%;
  }

  .button-primary:hover {
    background-color: #f8f8f8;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }

  .button-primary span {
    position: relative;
    z-index: 2;
  }

  /* --- SLIDE INDICATORS (DOTS) --- */
  .slide-indicators-container {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 20;
    opacity: 1 !important;
    visibility: visible !important;
  }

  .slide-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease
    , width 0.3s ease;
    border: 2px solid{{ section.settings.indicator_color }};
    background-color: transparent;
    transform: scale(1.0);
  }

  .slide-indicator.active {
    background-color: {{ section.settings.indicator_color }};
    border-color: {{ section.settings.indicator_color }};
    width: 28px;
    border-radius: 6px;
    transform: scale(1.0);
  }

  .slide-indicator:hover:not(.active) {
    background-color: {{ section.settings.indicator_color | color_modify: 'alpha', 0.2 }};
  }

  /* --- NAVIGATION ARROWS --- */
  .slide-nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 30;
    background: transparent;
    border: none;
    cursor: pointer;
    color: {{ section.settings.indicator_color }};
    font-size: 2.5rem;
    opacity: 0.7;
    padding: 1rem;
    transition: opacity 0.3s
    , color 0.3s;
    {% unless section.settings.show_navigation_arrows %}
      display: none;
    {% endunless %}
  }

  .slide-nav-arrow:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.1);
  }

  .slide-nav-arrow.prev {
    left: 10px;
  }

  .slide-nav-arrow.next {
    right: 10px;
  }

  /* --- ANIMATIONS --- */
  @keyframes slideInText {
    0% {
      opacity: 0;
      transform: translateY(15px) scale(0.98);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .slide-item.active .slide-content-wrapper {
    animation: slideInText 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.2s forwards;
    opacity: 0;
  }

  /* Mobile adjustments */
  @media (max-width: 768px) {
    .content-box {
      padding: 2rem 1.5rem;
      max-width: 90%;
    }
    .slide-content-alignment-wrapper {
      padding: 1.5rem;
      justify-content: center;
      align-items: center;
    }
    .slide-content-wrapper {
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .slide-content-wrapper .subheading {
      font-size: 10px;
      letter-spacing: 2px;
    }

    .slide-content-wrapper .heading {
      font-size: clamp(22px, 5vw, 32px);
      letter-spacing: 3px;
    }

    .button-primary {
      font-size: 10px;
      padding: 14px 32px !important;
    }

    .slide-indicators-container {
      bottom: 20px;
    }

    .slide-indicator {
      height: 10px;
      width: 10px;
    }
    .slide-indicator.active {
      width: 24px;
      height: 10px;
    }

    .slide-nav-arrow {
      font-size: 1.8rem;
      padding: 0.5rem;
    }
  }
{% endstyle %}

<section class="hero-slideshow-{{ section.id }} relative">
  {% liquid
    assign indicator_count = section.blocks.size
  %}

  {% for block in section.blocks %}
    {% liquid
      assign block_image = block.settings.image
      assign block_mobile_image = block.settings.mobile_image
      assign overlay_color = block.settings.overlay_color
      assign overlay_opacity = block.settings.overlay_opacity | times: 0.01
      assign text_color = block.settings.text_color
      assign content_style = block.settings.content_style
      assign content_position = block.settings.content_position

      assign content_style_class = ''
      if content_style == 'boxed'
        assign content_style_class = 'content-box'
      endif

      assign alignment_class = 'align-' | append: content_position | replace: '_', '-'

      assign text_align_class = ''
      if content_position contains 'left'
        assign text_align_class = 'text-pos-left'
      elsif content_position contains 'center'
        assign text_align_class = 'text-pos-center'
      elsif content_position contains 'right'
        assign text_align_class = 'text-pos-right'
      endif
    %}

    <div
      class="slide-item slide-{{ block.id }} {% if forloop.first %}active{% endif %}"
      data-slide-id="{{ block.id }}"
      data-index="{{ forloop.index0 }}"
      {{ block.shopify_attributes }}
      style="color: {{ text_color }};">
      <div class="absolute inset-0 z-10" style="background-color: {{ overlay_color | color_modify: 'alpha', overlay_opacity }};"></div>

      <div class="slide-bg-image absolute inset-0 w-full h-full z-0 bg-cover bg-center" style="background-image: url('{{ block_image | image_url: width: 1920 }}');">
        {% if block_mobile_image != blank %}
          <style>
            @media (max-width: 768px) {
              .slide-{{ block.id }}> .slide-bg-image {
                background-image: url('{{ block_mobile_image | image_url: width: 800 }}') !important;
              }
            }
          </style>
        {% endif %}
      </div>

      <div class="slide-content-alignment-wrapper {{ alignment_class }}">
        <div class="slide-content-wrapper {{ text_align_class }} {{ content_style_class }}">
          {% if block.settings.subheading != blank %}
            <p class="subheading">
              {{ block.settings.subheading | escape }}
            </p>
          {% endif %}

          {% if block.settings.heading != blank %}
            <h2 class="heading">
              {{ block.settings.heading | escape }}
            </h2>
          {% endif %}

          {% if block.settings.text != blank %}
            <div class="text">
              {{ block.settings.text }}
            </div>
          {% endif %}

          {% if block.settings.button_label_1 != blank %}
            <div class="mt-8">
              <a
                href="{{ block.settings.button_link_1 }}"
                class="button-primary"
                role="button">
                <span>{{ block.settings.button_label_1 | escape }}</span>
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% endfor %}

  {% if indicator_count > 1 %}
    {% if section.settings.show_navigation_arrows %}
      <button
        class="slide-nav-arrow prev"
        aria-label="Previous slide"
        id="slide-prev-{{ section.id }}">
        <svg
          width="30"
          height="30"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M15 18L9 12L15 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
      <button
        class="slide-nav-arrow next"
        aria-label="Next slide"
        id="slide-next-{{ section.id }}">
        <svg
          width="30"
          height="30"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            d="M9 18L15 12L9 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
    {% endif %}

    <div class="slide-indicators-container">
      {% for block in section.blocks %}
        <span
          class="slide-indicator {% if forloop.first %}active{% endif %}"
          data-index="{{ forloop.index0 }}"
          aria-label="Go to slide {{ forloop.index }}"
          role="button"
          tabindex="0"></span>
      {% endfor %}
    </div>
  {% endif %}
</section>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const sectionElement = document.querySelector(`.hero-slideshow-${sectionId}`);
    if (!sectionElement) return;

    const slides = sectionElement.querySelectorAll('.slide-item');
    const slideIndicators = sectionElement.querySelectorAll('.slide-indicator');
    const prevButton = document.getElementById(`slide-prev-${sectionId}`);
    const nextButton = document.getElementById(`slide-next-${sectionId}`);
    
    // FIXED: Correct rotation speed calculation
    const rotationSpeedSetting = {{ section.settings.rotation_speed | default: 6 }};
    const rotationSpeed = rotationSpeedSetting > 0 ? rotationSpeedSetting * 1000 : 0;

    let currentSlideIndex = 0;
    let slideInterval = null;

    if (slides.length <= 1) return; 

    function updateIndicators(index) {
      slideIndicators.forEach((indicator, i) => {
        indicator.classList.toggle('active', i === index);
      });
    }

    function showSlide(index) {
      if (index >= slides.length) index = 0;
      if (index < 0) index = slides.length - 1;

      slides.forEach((slide) => {
        slide.classList.remove('active');
      });

      const newSlide = slides[index];
      if (newSlide) {
        newSlide.classList.add('active');
      }

      updateIndicators(index);
      currentSlideIndex = index;
    }

    function nextSlide() {
      showSlide(currentSlideIndex + 1);
    }

    function prevSlide() {
      showSlide(currentSlideIndex - 1);
    }

    const startRotation = () => {
      if (slideInterval) clearInterval(slideInterval);
      if (rotationSpeed > 0) {
        slideInterval = setInterval(nextSlide, rotationSpeed);
      }
    };

    // Initialize
    showSlide(0);
    startRotation();

    // Navigation events
    if (prevButton && nextButton) {
      prevButton.addEventListener('click', () => {
        prevSlide();
        startRotation();
      });

      nextButton.addEventListener('click', () => {
        nextSlide();
        startRotation();
      });
    }

    // Indicator events
    slideIndicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        if (index !== currentSlideIndex) {
          showSlide(index);
          startRotation();
        }
      });
      
      indicator.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          if (index !== currentSlideIndex) {
            showSlide(index);
            startRotation();
          }
        }
      });
    });

    // Pause on hover
    sectionElement.addEventListener('mouseenter', () => {
      if (slideInterval) {
        clearInterval(slideInterval);
        slideInterval = null;
      }
    });

    sectionElement.addEventListener('mouseleave', () => {
      startRotation();
    });

    // Ensure slideshow works even if page is hidden
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        if (slideInterval) {
          clearInterval(slideInterval);
          slideInterval = null;
        }
      } else {
        startRotation();
      }
    });

  })();
</script>

{% schema %}
  {
    "name": "Hero Slideshow",
    "tag": "section",
    "class": "section-slideshow",
    "max_blocks": 5,
    "settings": [
      {
        "type": "range",
        "id": "rotation_speed",
        "min": 0,
        "max": 30,
        "step": 1,
        "unit": "sec",
        "label": "Auto rotate between slides",
        "default": 6,
        "info": "Set to 0 to disable auto rotation."
      },
      {
        "type": "header",
        "content": "Navigation Settings"
      },
      {
        "type": "checkbox",
        "id": "show_navigation_arrows",
        "label": "Show Left/Right Arrows",
        "default": true
      },
      {
        "type": "header",
        "content": "Visual Settings"
      }, {
        "type": "color",
        "id": "indicator_color",
        "label": "Indicator/Arrow Color",
        "default": "#FFFFFF"
      }
    ],
    "blocks": [
      {
        "type": "slide",
        "name": "Slide",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Desktop image",
            "info": "1920 x 1080px recommended"
          },
          {
            "type": "image_picker",
            "id": "mobile_image",
            "label": "Mobile image (Optional)",
            "info": "768 x 1200px recommended"
          },
          {
            "type": "header",
            "content": "Content"
          },
          {
            "type": "select",
            "id": "content_style",
            "label": "Content Style",
            "default": "boxed",
            "options": [
              {
                "value": "default",
                "label": "Standard (No Border)"
              }, {
                "value": "boxed",
                "label": "Boxed (With Border)"
              }
            ]
          }, {
            "type": "text",
            "id": "subheading",
            "label": "Subheading",
            "default": "OUR BAG"
          }, {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "ELEGANT & TIMELESS"
          }, {
            "type": "richtext",
            "id": "text",
            "label": "Text (Optional)"
          }, {
            "type": "select",
            "id": "content_position",
            "label": "Content position",
            "default": "middle_center",
            "options": [
              {
                "value": "top_left",
                "label": "Top left"
              },
              {
                "value": "top_center",
                "label": "Top center"
              },
              {
                "value": "top_right",
                "label": "Top right"
              },
              {
                "value": "middle_left",
                "label": "Middle left"
              }, {
                "value": "middle_center",
                "label": "Middle center"
              }, {
                "value": "middle_right",
                "label": "Middle right"
              }, {
                "value": "bottom_left",
                "label": "Bottom left"
              }, {
                "value": "bottom_center",
                "label": "Bottom center"
              }, {
                "value": "bottom_right",
                "label": "Bottom right"
              }
            ]
          }, {
            "type": "header",
            "content": "Colors & Overlay"
          }, {
            "type": "color",
            "id": "text_color",
            "label": "Text Color",
            "default": "#FFFFFF"
          }, {
            "type": "color",
            "id": "overlay_color",
            "label": "Overlay Color",
            "default": "#000000"
          }, {
            "type": "range",
            "id": "overlay_opacity",
            "min": 0,
            "max": 100,
            "step": 5,
            "unit": "%",
            "label": "Overlay Opacity",
            "default": 20
          }, {
            "type": "header",
            "content": "Button"
          }, {
            "type": "text",
            "id": "button_label_1",
            "label": "Button Text",
            "default": "VIEW COLLECTION"
          }, {
            "type": "url",
            "id": "button_link_1",
            "label": "Button Link"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Hero Slideshow",
        "blocks": [
          {
            "type": "slide",
            "settings": {
              "subheading": "OUR BAG",
              "heading": "ELEGANT & TIMELESS",
              "button_label_1": "VIEW COLLECTION",
              "content_style": "boxed"
            }
          }, {
            "type": "slide",
            "settings": {
              "subheading": "OUR BAG",
              "heading": "INSPIRED BY THE 90S",
              "button_label_1": "SHOP NOW",
              "content_style": "boxed"
            }
          }
        ]
      }
    ]
  }
{% endschema %}