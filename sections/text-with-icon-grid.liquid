{% comment %}
  SECTION: TEXT WITH ICON GRID
  Displays a grid of text/icon blocks. Designed to be highly configurable via schema settings.
{% endcomment %}

{% assign icon_width = section.settings.icon_width | default: 50 %}
{% assign mobile_icon_width = section.settings.mobile_icon_width | default: 35 %}
{% assign text_align = section.settings.text_alignment %}
{% assign icon_color = section.settings.icon_color %}{% assign text_color = section.settings.text_color %}

{% comment %} Determine CSS text alignment {% endcomment %}
{% assign css_text_align = 'center' %}
{% if text_align == 'left' %}
  {% assign css_text_align = 'left' %}
{% elsif text_align == 'right' %}
  {% assign css_text_align = 'right' %}
{% endif %}

<style>
  /* Use Inter font for consistency, similar to previous sections */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

  .section-{{ section.id }} {
    /* Apply color scheme if defined, otherwise use light gray background from image */
    background-color: {% if section.settings.color_scheme == 'transparent' %}transparent{% else %}{{ section.settings.color_scheme }}
{% endif %};
  padding: 60px 20px;
  font-family: 'Inter'
  , sans-serif;
  color: #333333;
  /* Default text color */
}

{% if section.settings.separator %}
  .section-{{ section.id }} {
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
{% endif %}

/* --- Grid Layout --- */
.icon-grid-wrapper {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  max-width: 1200px;
  margin: 0 auto;
  text-align: {{ css_text_align }};
  /* Apply global text alignment */
}

/* --- Individual Column Block --- */
.icon-grid-block {
  flex: 0 0 25%;
  /* 4 columns on desktop */
  max-width: 25%;
  padding: 20px;
  margin-bottom: 30px;
}

/* --- Content Alignment --- */
.icon-grid-block__content {
  /* Use flex to align icon and text block based on text_alignment setting */
  display: flex;
  flex-direction: column;
  align-items: {% if text_align == 'left' %}flex-start{% elsif text_align == 'right' %}flex-end{% else %}center{% endif %};
  text-align: {{ css_text_align }};
}

/* --- Icon Styling --- */
.icon-grid-block__icon {
  width: {{ icon_width }}px;
  height: auto;
  margin-bottom: 15px;
  /* Icon color setting */
  fill: {% if icon_color == 'transparent' %}transparent{% else %}{{ icon_color }}
{% endif %};
  stroke: {% if icon_color == 'transparent' %}transparent{% else %}{{ icon_color }}
{% endif %};
}

/* If icon color is transparent, attempt to set stroke/fill color based on context (default to dark gray) */
{% if icon_color == 'transparent' %}
  .icon-grid-block__icon {
    fill: currentColor;
    stroke: currentColor;
    color: #555555;
  }
{% endif %}

/* --- Text Styling --- */
.icon-grid-block__heading {
  font-size: 0.85rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 5px;
  /* Text color setting */
  color: {% if text_color == 'transparent' %}#333333{% else %}{{ text_color }}
{% endif %};
}

.icon-grid-block__content-text {
  font-size: 0.8rem;
  line-height: 1.4;
  color: #888;
}

/* --- Mobile Responsiveness --- */
@media (max-width: 749px) {
  .section-{{ section.id }} {
    padding: 40px 10px;
  }

  .icon-grid-block {
    flex: 0 0 50%;
    /* 2 columns on mobile */
    max-width: 50%;
    padding: 10px;
    margin-bottom: 20px;
  }

  .icon-grid-block__icon {
    width: {{ mobile_icon_width }}px;
    /* Mobile icon width */
    margin-bottom: 10px;
  }
}

/* Custom CSS from settings */
{%- if section.settings.custom_css != blank -%}
  {{ section.settings.custom_css }}
{%- endif -%}
</style>

<section
  class="section-{{ section.id }}"
  {% if section.settings.color_scheme != 'transparent' %}
  data-color-scheme="{{ section.settings.color_scheme }}"
  {% endif %}>

  <div class="icon-grid-wrapper">
    {% for block in section.blocks %}
      <div class="icon-grid-block" {{ block.shopify_attributes }}>
        <div class="icon-grid-block__content">

          {% comment %}
            Display the icon: Custom image takes priority over the built-in icon picker
          {% endcomment %}
          {% if block.settings.custom_icon != blank %}
            <img
              src="{{ block.settings.custom_icon | image_url: width: 128 }}"
              loading="lazy"
              alt="{{ block.settings.heading | escape }}"
              class="icon-grid-block__icon icon-grid-block__icon--image"
              width="{{ icon_width }}">
          {% else %}
            {% comment %}
              Render the liquid icon snippet (requires a snippet file named icon-VALUE.liquid)
            {% endcomment %}
            {% assign icon_handle = 'icon-' | append: block.settings.icon %}
            {% render icon_handle
              , class: 'icon-grid-block__icon' %}
          {% endif %}

          <h3 class="icon-grid-block__heading">
            {{ block.settings.heading | escape }}
          </h3>

          <div class="icon-grid-block__content-text">
            {{ block.settings.content | escape }}
          </div>

        </div>
      </div>
    {% endfor %}
  </div>

</section>


{% schema %}
  {
    "name": "Text with Icon Grid",
    "tag": "section",
    "class": "section-text-icon-grid",
    "settings": [
      {
        "type": "header",
        "content": "Theme Settings"
      },
      {
        "type": "select",
        "id": "color_scheme",
        "label": "Color scheme",
        "options": [
          {
            "value": "#f2f2f2",
            "label": "Scheme 1 (Light Gray)"
          }, {
            "value": "#ffffff",
            "label": "Scheme 2 (White)"
          }, {
            "value": "#333333",
            "label": "Scheme 3 (Dark)"
          }, {
            "value": "transparent",
            "label": "Transparent"
          }
        ],
        "default": "#f2f2f2"
      },
      {
        "type": "checkbox",
        "id": "separator",
        "label": "Separate section with border",
        "default": false
      },
      {
        "type": "select",
        "id": "text_alignment",
        "label": "Text alignment",
        "options": [
          {
            "value": "left",
            "label": "Left"
          }, {
            "value": "center",
            "label": "Center"
          }, {
            "value": "right",
            "label": "Right"
          }
        ],
        "default": "center"
      }, {
        "type": "color",
        "id": "icon_color",
        "label": "Icon color",
        "default": "#555555"
      }, {
        "type": "color",
        "id": "text_color",
        "label": "Text color",
        "default": "#333333"
      }, {
        "type": "header",
        "content": "Layout"
      }, {
        "type": "range",
        "id": "icon_width",
        "min": 20,
        "max": 100,
        "step": 5,
        "unit": "px",
        "label": "Icon width",
        "default": 50
      }, {
        "type": "range",
        "id": "mobile_icon_width",
        "min": 15,
        "max": 60,
        "step": 5,
        "unit": "px",
        "label": "Mobile icon width",
        "default": 35
      }, {
        "type": "header",
        "content": "Custom CSS"
      }, {
        "type": "textarea",
        "id": "custom_css",
        "label": "Custom CSS",
        "info": "Add custom styles for this section."
      }
    ],
    "blocks": [
      {
        "type": "icon_item",
        "name": "Text with Icon",
        "settings": [
          {
            "type": "header",
            "content": "Icon"
          },
          {
            "type": "select",
            "id": "icon",
            "label": "Icon",
            "options": [
              {
                "value": "award-gift",
                "label": "Award gift"
              },
              {
                "value": "bag-handle",
                "label": "Bag handle"
              },
              {
                "value": "building",
                "label": "Building"
              },
              {
                "value": "coupon",
                "label": "Coupon"
              }, {
                "value": "gift",
                "label": "Gift"
              }, {
                "value": "info",
                "label": "Info"
              }, {
                "value": "love",
                "label": "Love"
              }, {
                "value": "percent",
                "label": "Percent"
              }, {
                "value": "star",
                "label": "Star"
              }, {
                "value": "box",
                "label": "Box"
              }, {
                "value": "delivery-truck",
                "label": "Delivery truck"
              }, {
                "value": "pin",
                "label": "Pin"
              }, {
                "value": "plane",
                "label": "Plane"
              }, {
                "value": "return",
                "label": "Return"
              }, {
                "value": "credit-card",
                "label": "Credit card"
              }, {
                "value": "lock",
                "label": "Lock"
              }, {
                "value": "money",
                "label": "Money"
              }, {
                "value": "secure-profile",
                "label": "Secure profile"
              }, {
                "value": "shield",
                "label": "Shield"
              }, {
                "value": "earth",
                "label": "Earth"
              }, {
                "value": "leaf",
                "label": "Leaf"
              }, {
                "value": "recycle",
                "label": "Recycle"
              }, {
                "value": "tree",
                "label": "Tree"
              }, {
                "value": "at-sign",
                "label": "At sign"
              }, {
                "value": "bluetooth",
                "label": "Bluetooth"
              }, {
                "value": "camera",
                "label": "Camera"
              }, {
                "value": "printer",
                "label": "Printer"
              }, {
                "value": "smart-watch",
                "label": "Smart watch"
              }, {
                "value": "wifi",
                "label": "WiFi"
              }, {
                "value": "avatar",
                "label": "Avatar"
              }, {
                "value": "chat",
                "label": "Chat"
              }, {
                "value": "calendar",
                "label": "Calendar"
              }, {
                "value": "comment",
                "label": "Comment"
              }, {
                "value": "customer-support",
                "label": "Customer support"
              }, {
                "value": "happy-face",
                "label": "Happy face"
              }, {
                "value": "mailbox",
                "label": "Mailbox"
              }, {
                "value": "mobile-phone",
                "label": "Mobile phone"
              }, {
                "value": "operator",
                "label": "Operator"
              }, {
                "value": "phone",
                "label": "Phone"
              }, {
                "value": "send",
                "label": "Send"
              }, {
                "value": "user",
                "label": "User"
              }, {
                "value": "burger",
                "label": "Burger"
              }, {
                "value": "beer",
                "label": "Beer"
              }, {
                "value": "coffee",
                "label": "Coffee"
              }, {
                "value": "pizza",
                "label": "Pizza"
              }, {
                "value": "bottle",
                "label": "Bottle"
              }, {
                "value": "document",
                "label": "Document"
              }, {
                "value": "error",
                "label": "Error"
              }, {
                "value": "file",
                "label": "File"
              }, {
                "value": "jewelry",
                "label": "Jewelry"
              }, {
                "value": "mask",
                "label": "Mask"
              }, {
                "value": "music",
                "label": "Music"
              }, {
                "value": "not-allowed",
                "label": "Not allowed"
              }, {
                "value": "target",
                "label": "Target"
              }, {
                "value": "timer",
                "label": "Timer"
              }, {
                "value": "success",
                "label": "Success"
              }
            ],
            "default": "award-gift"
          },
          {
            "type": "image_picker",
            "id": "custom_icon",
            "label": "Custom icon",
            "info": "Upload an image to override the selected icon. 128 x 128px .png recommended."
          },
          {
            "type": "header",
            "content": "Text"
          }, {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "Free delivery worldwide"
          }, {
            "type": "textarea",
            "id": "content",
            "label": "Content",
            "default": "Short content about your store"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Text with Icon Grid",
        "category": "Text",
        "blocks": [
          {
            "type": "icon_item"
          }, {
            "type": "icon_item"
          }, {
            "type": "icon_item"
          }, {
            "type": "icon_item"
          }
        ]
      }
    ]
  }
{% endschema %}